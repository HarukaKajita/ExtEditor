# ExportPackageConfig Tool

このファイルは、ExportPackageConfigツールでの作業時にClaude Codeへのガイダンスを提供します。

## ツール概要

ExportPackageConfigツールは、Unityパッケージエクスポートの精密制御を提供するエディター拡張です。依存関係管理、高度なフィルタリング、複雑なインクルード・エクスクルードパターンをサポートします。

## 主要機能

### 基本機能
- **Unity パッケージエクスポート**: .unitypackage ファイルの設定可能なエクスポート
- **依存関係管理**: アセット依存関係の自動包含・除外制御
- **高度フィルタリング**: フォルダー含有を含む複雑なインクルード・エクスクルードパターン
- **柔軟なパス表現**: プレースホルダーを使用した設定可能出力パス
- **アセット可視化**: エクスポートに含まれるアセットの正確な表示
- **Package Manager フィルタリング**: Package Manager アセットの自動除外

### 使用方法
1. アセット作成: Project右クリック → Create → Scriptableobject → ExportPackageConfig
2. エクスポート設定を構成:
   - **Export Path Expression**: `<ProjectPath>`, `<ConfigName>`, `<Date>` などのプレースホルダー使用
   - **Include Dependencies**: 依存関係包含の切り替え
   - **Export Entry Assets**: 含めるアセット・フォルダーを追加
   - **Exclude Assets**: 除外するアセット・フォルダーを追加
3. "unitypackageをパッケージを書き出す"をクリックしてエクスポート
4. "エクスプローラーで開く"で出力ディレクトリを表示
5. Inspector でアセットリストを確認

## 実装詳細

### ファイル構造
- **ExportPackageConfig.cs**: ScriptableObject実装とカスタムエディター

### データ構造
```csharp
[SerializeField] string exportPathExpression;
[SerializeField] bool includeDependencies;
[SerializeField] List<UnityEngine.Object> exportEntryAssets;
[SerializeField] List<UnityEngine.Object> excludeAssets;
```

### プレースホルダーシステム
- **`<ProjectPath>`**: プロジェクトルートディレクトリ
- **`<AssetsPath>`**: Assetsフォルダーパス
- **`<ConfigName>`**: ScriptableObjectアセット名
- **`<Date>`**: 現在日付（yyyyMMdd）
- **`<Time>`**: 現在時刻（HHmmss）

## 技術的特徴

### 複雑な依存関係計算
- **OnValidate()**: アセット依存関係計算の複雑なロジック
- **AssetDatabase.GetDependencies()**: 依存関係解析
- **効率的重複除去**: LINQを使用したアセット重複排除

### フォルダー処理
- **AssetDatabase.FindAssets()**: フォルダー内容の再帰的発見
- **フォルダー展開**: フォルダーをすべての含有アセットに展開
- **階層処理**: ネストしたフォルダー構造の完全処理

### Package Manager 統合
- **自動除外**: Package Manager アセットの自動フィルタリング
- **パスベースフィルタ**: "Packages/" パスでの自動除外
- **クリーンエクスポート**: プロジェクト固有アセットのみ包含

## 設定詳細

### パス表現例
```
<ProjectPath>/Exports/<ConfigName>_<Date>.unitypackage
// 結果: /path/to/project/Exports/MyConfig_20241214.unitypackage
```

### 自動除外
- **Package Manager**: "Packages/" で始まるパスを自動除外
- **無効アセット**: 存在しないまたは破損したアセットを除外
- **重複アセット**: 同じアセットの複数エントリを重複除去

### カスタムエディター
- **展開可能リスト**: 大量アセットでの展開可能アセットリスト
- **リアルタイム更新**: 設定変更時の即座のアセットリスト更新
- **視覚的フィードバック**: 含まれるアセットの明確な表示

## 開発ノート

### パフォーマンス最適化
- **遅延計算**: OnValidate()での効率的な依存関係計算
- **キャッシュ戦略**: 大きなアセットリストでの効率的な処理
- **バッチ処理**: AssetDatabase操作の最適化

### エラーハンドリング
- **パス検証**: 無効な出力パスの適切な処理
- **権限チェック**: 書き込み権限の確認
- **アセット存在確認**: 削除されたアセット参照の処理

### クロスプラットフォーム対応
- **パス正規化**: 異なるOS間でのパス互換性
- **ファイル名サニタイズ**: 無効な文字の自動除去
- **パス区切り**: 適切なパス区切り文字の使用

### 拡張可能性
- **カスタムプレースホルダー**: 新しいプレースホルダーの追加
- **フィルタールール**: 高度なフィルタリングルールの実装
- **エクスポートフック**: エクスポート前後の処理フック

### 使用場面
- **アセット配布**: 特定アセットセットの配布パッケージ作成
- **バックアップ**: プロジェクトの部分的バックアップ
- **チーム共有**: チーム間でのアセット共有
- **バージョン管理**: アセットの版管理とリリース

### 制限事項
- **Unity制限**: Unityの.unitypackage形式制限に従う
- **ファイルサイズ**: 大量アセットでのファイルサイズ制限
- **パス長制限**: OS固有のパス長制限

### ベストプラクティス
- **テストエクスポート**: 本番前の小規模テストエクスポート
- **依存関係確認**: 必要な依存関係の漏れがないか確認
- **除外リスト管理**: 不要アセットの適切な除外設定

### トラブルシューティング
- **エクスポート失敗**: 権限問題やパス問題の診断
- **依存関係問題**: 不足依存関係の特定と解決
- **パフォーマンス**: 大量アセット処理時の最適化

### 将来の機能
- **増分エクスポート**: 変更されたアセットのみのエクスポート
- **圧縮オプション**: カスタム圧縮設定
- **メタデータ除外**: 特定メタデータの選択的除外