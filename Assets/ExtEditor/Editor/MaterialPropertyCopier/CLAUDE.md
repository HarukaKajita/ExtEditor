# MaterialPropertyCopier Tool

このファイルは、MaterialPropertyCopierツールでの作業時にClaude Codeへのガイダンスを提供します。

## ツール概要

MaterialPropertyCopierツールは、マテリアル間でシェーダープロパティを選択的にコピーするエディター拡張です。複数のターゲットマテリアルに対して、特定のプロパティのみを転送できます。

## 主要機能

### 基本機能
- **マテリアルプロパティ転送**: ソースマテリアルから複数のターゲットマテリアルへプロパティをコピー
- **選択的コピー**: チェックボックスでコピーするプロパティを個別選択
- **プロパティタイプサポート**: Color、Vector、Float、Range、Textureプロパティに対応
- **複数ターゲット**: 複数の宛先マテリアルをサポート
- **ドラッグ&ドロップ**: マテリアルを直接ターゲットリストにドラッグ可能
- **タイプセーフティ**: ソースとターゲット間でプロパティタイプの一致を検証

### 使用方法
1. **ツール → Material Property Copier**メニューからアクセス
2. ObjectFieldでソースマテリアルを設定
3. チェックボックスで希望プロパティを選択（Select All/Select Noneボタン利用可能）
4. "Copy Selected Properties from Source"をクリック
5. ターゲットマテリアルを追加:
   - Projectでマテリアルを選択し"Add Selected Materials"をクリック
   - マテリアルをドラッグ&ドロップエリアにドラッグ
   - ターゲットリストの個別ObjectFieldを使用
6. "Paste Copied Properties to Target(s)"をクリック

## 実装詳細

### 主要クラス
- **MaterialPropertyCopier**: EditorWindowの単一クラス実装
- **全機能統合**: ソース選択、プロパティコピー、ターゲット管理を一つのクラスで実装

### プロパティ管理
- **プロパティ検査**: `ShaderUtil`を使用してシェーダープロパティを検査
- **タイプ判定**: プロパティタイプの自動判定と互換性チェック
- **辞書ベース**: コピーしたプロパティをタイプ情報付きで辞書に保存

### UI機能
- **ドラッグ&ドロップ**: `DragAndDrop` APIを使用した直感的なマテリアル追加
- **アルファベット順ソート**: プロパティは表示名でアルファベット順にソート
- **Undo対応**: プロパティ貼り付け操作でUndo/Redoサポート

## 技術的特徴

### プロパティタイプサポート
- **Color**: カラープロパティの完全サポート
- **Vector**: Vector4プロパティの転送
- **Float/Range**: 数値プロパティの処理
- **Texture**: テクスチャプロパティの参照転送

### エラーハンドリング
- **タイプ不一致**: プロパティタイプが一致しない場合の詳細ログ
- **null参照**: マテリアルやプロパティのnullチェック
- **無効プロパティ**: 存在しないプロパティへのアクセス保護

### バッチ処理
- **複数ターゲット**: 一度に複数のマテリアルに対してプロパティを適用
- **効率的転送**: プロパティタイプごとの最適化された転送メソッド
- **選択的適用**: 選択されたプロパティのみを処理

## 開発ノート

### データ構造
```csharp
Dictionary<string, object> copiedProperties; // プロパティ名と値のペア
Dictionary<string, ShaderPropertyType> propertyTypes; // プロパティタイプ情報
List<Material> targetMaterials; // ターゲットマテリアルリスト
```

### 主要メソッド
- **CopySelectedProperties()**: 選択プロパティをソースからコピー
- **PasteCopiedProperties()**: コピーしたプロパティをターゲットに適用
- **ValidatePropertyType()**: プロパティタイプの互換性チェック

### 拡張ポイント
- **新しいプロパティタイプ**: `ShaderPropertyType`enumに新しいタイプを追加
- **カスタムUI**: プロパティ表示のカスタマイズは`DrawPropertyList()`メソッドで実装
- **バッチ操作**: 大量マテリアル処理用のプログレスバー追加可能

### 注意点
- **シェーダー互換性**: 同じシェーダーまたは互換性のあるシェーダー間でのみ使用推奨
- **プロパティ名**: プロパティ名の完全一致が必要
- **アセットvsプロシージャル**: アセットベースとプロシージャルマテリアル両方に対応